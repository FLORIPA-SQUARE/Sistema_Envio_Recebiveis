---
title: Fluxo operacional completo
description: Passo a passo de ponta a ponta ‚Äî da prepara√ß√£o ao envio final
---

# Fluxo operacional completo

Este documento descreve o fluxo operacional completo do sistema de automa√ß√£o de boletos, desde a prepara√ß√£o inicial at√© o envio final e arquivamento.

## Vis√£o geral das 5 fases

```mermaid
graph LR
    A[1. Prepara√ß√£o<br/>MANUAL] --> B[2. Coleta<br/>MANUAL]
    B --> C[3. Processamento<br/>AUTOMATIZADO]
    C --> D[4. Envio<br/>SEMI-AUTOMATIZADO]
    D --> E[5. Finaliza√ß√£o<br/>MANUAL]
    
    style A fill:#fff3cd,stroke:#856404
    style B fill:#fff3cd,stroke:#856404
    style C fill:#d4edda,stroke:#155724
    style D fill:#d1ecf1,stroke:#0c5460
    style E fill:#fff3cd,stroke:#856404
```

<Note>
**Legenda de cores:**
- üü° **Amarelo** = Etapa manual (operador executa)
- üü¢ **Verde** = Etapa automatizada (sistema executa)
- üîµ **Azul** = Etapa semi-automatizada (sistema + operador)
</Note>

## Fase 1: Prepara√ß√£o (manual)

<Steps>
  <Step title="Opera√ß√£o aprovada pela FIDC">
    Ap√≥s an√°lise de cr√©dito, a FIDC aprova a opera√ß√£o de antecipa√ß√£o e envia o **Termo de Duplicatas** para assinatura.
    
    **Documentos recebidos:**
    - Termo de Duplicatas (PDF assinado)
    - Rela√ß√£o de boletos da opera√ß√£o
    - N√∫mero da opera√ß√£o (ex: "Opera√ß√£o 1234")
  </Step>
  
  <Step title="Criar estrutura de pastas no servidor">
    O operador cria a estrutura de pastas para organizar a opera√ß√£o:
    
    ```
    Servidor JJ > Cobran√ßas > Cobran√ßa [FIDC] > [Ano] > [N¬∫ Opera√ß√£o]
    ```
    
    **Exemplo real:**
    ```
    \\SERVIDOR\Cobran√ßas\Cobran√ßa NOVAX\2025\Opera√ß√£o 1234\
    ```
    
    **Subpastas criadas:**
    - `Boletos/` - Boletos originais baixados da FIDC
    - `Notas/` - XMLs das notas fiscais
    - `Documentos/` - Termo de Duplicatas e outros docs
  </Step>
  
  <Step title="Verificar XMLs das notas fiscais">
    Antes de processar, confirmar que **todos os XMLs** das notas fiscais est√£o dispon√≠veis na pasta `Notas/`.
    
    <Warning>
    O sistema **rejeita boletos** se o XML correspondente n√£o for encontrado. Isso √© uma prote√ß√£o cr√≠tica para evitar envios incorretos.
    </Warning>
    
    **Como obter XMLs:**
    - Exportar do sistema Viasoft (ERP da JJ)
    - Verificar que o nome do arquivo cont√©m o n√∫mero da nota (ex: `310227.xml`)
  </Step>
</Steps>

## Fase 2: Coleta de dados (manual)

<Steps>
  <Step title="Copiar XMLs para pasta do sistema">
    Copiar (NUNCA recortar) os XMLs das notas fiscais para a pasta `Notas/` do sistema de automa√ß√£o.
    
    ```
    Origem:  \\SERVIDOR\Viasoft\XMLs\
    Destino: C:\BoletosAutoma√ß√£o\Notas\
    ```
    
    <Tip>
    **Por que copiar e n√£o recortar?**
    - Manter backup dos XMLs no servidor
    - Evitar perda de dados em caso de erro
    - Permitir reprocessamento se necess√°rio
    </Tip>
  </Step>
  
  <Step title="Baixar boletos do site da FIDC">
    Acessar o portal da FIDC e baixar os boletos da opera√ß√£o.
    
    **Formato recebido:**
    - Geralmente um **PDF √∫nico** contendo todos os boletos da opera√ß√£o
    - Cada p√°gina = 1 boleto
    
    **Exemplo:**
    - Opera√ß√£o com 15 boletos = 1 PDF com 15 p√°ginas
  </Step>
  
  <Step title="Separar boletos com iLovePDF">
    Usar o site [iLovePDF](https://www.ilovepdf.com/pt/dividir_pdf) para separar o PDF √∫nico em arquivos individuais.
    
    **Processo:**
    1. Upload do PDF √∫nico
    2. Selecionar "Extrair todas as p√°ginas"
    3. Download do ZIP com boletos separados
    4. Extrair arquivos do ZIP
    
    <Warning>
    **Aten√ß√£o √† privacidade:**
    O iLovePDF √© um site p√∫blico. Os boletos ficam temporariamente em servidores externos. Deletar os arquivos do site ap√≥s o download.
    </Warning>
  </Step>
  
  <Step title="Mover boletos para BoletosEntrada/">
    Mover os boletos separados para a pasta de entrada do sistema:
    
    ```
    C:\BoletosAutoma√ß√£o\BoletosEntrada\
    ```
    
    **Resultado esperado:**
    - 15 arquivos PDF individuais
    - Nomes originais (ex: `1.pdf`, `2.pdf`, etc.)
  </Step>
</Steps>

## Fase 3: Processamento (automatizado)

<Steps>
  <Step title="Executar sistema de automa√ß√£o">
    Abrir o sistema e selecionar a FIDC correspondente.
    
    **Interface:**
    - 4 bot√µes coloridos (Capital RS, Novax, Credvale, Squid)
    - Status em tempo real (XMLs carregados, boletos encontrados)
    - Log de execu√ß√£o
  </Step>
  
  <Step title="Renomear boletos">
    Clicar no bot√£o **"Renomear Boletos"**.
    
    **O que o sistema faz:**
    1. L√™ cada PDF da pasta `BoletosEntrada/`
    2. Extrai dados do boleto:
       - Nome do pagador
       - Data de vencimento
       - Valor
       - N√∫mero da nota fiscal
    3. Busca o XML correspondente (por n√∫mero da nota)
    4. Valida dados cruzados (boleto ‚Üî XML)
    5. Renomeia o arquivo no formato:
       ```
       NOME DO PAGADOR - NF 310227 - 13-01 - R$ 2.833,34.pdf
       ```
    6. Move para pasta `BoletosRenomeados/`
    
    **Tempo estimado:** 5-10 segundos por boleto
  </Step>
  
  <Step title="Confer√™ncia visual (opcional)">
    Recomendado durante testes ou opera√ß√µes cr√≠ticas.
    
    **O que conferir:**
    - Nomes dos arquivos est√£o corretos
    - Valores batem com o Termo de Duplicatas
    - Todos os boletos foram renomeados (nenhum ficou em `BoletosEntrada/`)
    
    <Tip>
    Se algum boleto n√£o foi renomeado, verificar o log de erros em `Erros/erros_[data].txt` para identificar o problema.
    </Tip>
  </Step>
</Steps>

## Fase 4: Envio (semi-automatizado)

Esta √© a fase mais cr√≠tica do processo. O sistema valida, agrupa e prepara os e-mails, mas o operador confere antes de enviar.

<Steps>
  <Step title="Valida√ß√£o de totais">
    Antes de enviar, o operador deve conferir:
    
    **Quantidade de boletos:**
    - Total de boletos renomeados = Total no Termo de Duplicatas
    
    **Valor total:**
    - Soma dos valores dos boletos = Valor total no Termo
    
    <Warning>
    Se houver diverg√™ncia, **N√ÉO prosseguir**. Investigar:
    - Boletos faltando?
    - Valores incorretos?
    - XMLs ausentes?
    </Warning>
  </Step>
  
  <Step title="Executar envio">
    Clicar no bot√£o **"Enviar Boletos"**.
    
    **O que o sistema faz:**
    1. Carrega todos os XMLs da pasta `Notas/`
    2. Para cada boleto em `BoletosRenomeados/`:
       - Extrai CNPJ do PDF
       - Detecta FIDC (benefici√°rio)
       - Extrai data de vencimento
       - **Valida em 5 camadas** (ver detalhes abaixo)
    3. Agrupa boletos por cliente (mesmo e-mail)
    4. Cria e-mails no Outlook (modo preview)
  </Step>
  
  <Step title="Sistema de valida√ß√£o em 5 camadas">
    Cada boleto passa por valida√ß√£o rigorosa antes do envio:
    
    **Camada 1: XML**
    - Busca XML correspondente ao n√∫mero da nota
    - Verifica se XML √© v√°lido
    - ‚úÖ Aprovado: XML encontrado | ‚ùå Rejeitado: XML n√£o encontrado
    
    **Camada 2: CNPJ**
    - Compara CNPJ do boleto com CNPJ do XML
    - ‚úÖ Aprovado: CNPJs id√™nticos | ‚ùå Rejeitado: CNPJs divergentes
    
    **Camada 3: Nome**
    - Compara nome do pagador (boleto vs XML)
    - Usa fuzzy matching (similaridade ‚â• 85%)
    - ‚úÖ Aprovado: Nomes similares | ‚ö†Ô∏è Aviso: Similaridade baixa (mas aceita)
    
    **Camada 4: Valor**
    - Compara valor do boleto com valor do XML
    - Toler√¢ncia: **0 centavos** (deve ser exato)
    - Prioriza valor da duplicata (se match por vencimento)
    - ‚úÖ Aprovado: Valores id√™nticos | ‚ùå Rejeitado: Diferen√ßa > 0 centavos
    
    **Camada 5: Email**
    - Valida e-mails extra√≠dos do XML
    - Verifica formato e completude
    - ‚úÖ Aprovado: Pelo menos 1 e-mail v√°lido | ‚ùå Rejeitado: Nenhum e-mail v√°lido
    
    <Note>
    Boletos rejeitados s√£o movidos para `Erros/` com relat√≥rio detalhado do motivo da rejei√ß√£o.
    </Note>
  </Step>
  
  <Step title="Estrutura do e-mail enviado">
    **Remetente:**
    ```
    cobranca@jotajota.net.br
    ```
    
    **Destinat√°rios:**
    - At√© 2 e-mails do cliente (extra√≠dos do XML da nota fiscal)
    - Exemplo: `compras@cliente.com.br; financeiro@cliente.com.br`
    
    **CC (c√≥pia):**
    Varia por FIDC:
    
    | FIDC | E-mails em CC |
    |------|---------------|
    | **Capital RS** | `adm@jotajota.net.br` |
    | **Novax** | `adm@jotajota.net.br`, `controladoria@novaxfidc.com.br` |
    | **Credvale** | `adm@jotajota.net.br`, `nichole@credvalefidc.com.br` |
    | **Squid** | `adm@jotajota.net.br` |
    
    **Assunto:**
    ```
    Boleto e Nota Fiscal (310227, 310228, 310229)
    ```
    
    **Corpo do e-mail:**
    ```html
    Boa tarde,
    
    Prezado cliente,
    NOME DO CLIENTE,
    
    Enviamos anexo o(s) seu(s) boleto(s) emitido(s) conforme a(as) nota(as): 310227, 310228, 310229
    
    Valor: R$ 2.833,34, Vencimento: 13/01/2026
    Valor: R$ 1.500,00, Vencimento: 20/01/2026
    Valor: R$ 3.200,50, Vencimento: 27/01/2026
    
    O(s) boleto(s) est√°(√£o) com benefici√°rio nominal a NOVAX FUNDO DE INVESTIMENTO EM DIREITOS CREDIT√ìRIOS, CNPJ: 28.879.551/0001-96.
    
    Vide boleto(s) e nota(s) em anexo.
    Favor confirmar recebimento.
    
    Em caso de d√∫vidas, nossa equipe permanece √† disposi√ß√£o para esclarecimentos.
    
    Atenciosamente,
    Equipe de Cobran√ßa
    
    [Imagem da assinatura]
    ```
    
    **Anexos:**
    - Boletos (PDFs renomeados)
    - XMLs das notas fiscais correspondentes
  </Step>
  
  <Step title="L√≥gica de agrupamento">
    O sistema agrupa m√∫ltiplos boletos do mesmo cliente em **1 √∫nico e-mail**.
    
    **Crit√©rio de agrupamento:**
    - Mesmo e-mail de destino
    - Mesmo cliente (nome normalizado)
    
    **Exemplo real (da entrevista):**
    
    Cliente: **Tempoville**
    - Nota Fiscal: **318976**
    - 3 parcelas (3 boletos)
    - Resultado: **1 e-mail** com 3 boletos anexados + 1 XML
    
    <Note>
    **Aten√ß√£o:** Os anexos podem vir fora de ordem cronol√≥gica. Isso √© normal e n√£o afeta o processamento.
    </Note>
  </Step>
  
  <Step title="Integra√ß√£o com Outlook (MODO_PREVIEW)">
    O sistema est√° configurado com `MODO_PREVIEW = True`, o que significa:
    
    **Comportamento atual:**
    - Sistema **abre** cada e-mail no Outlook
    - E-mail fica em modo rascunho
    - Operador **confere manualmente** cada e-mail
    - Operador clica em **"Enviar"** manualmente
    
    <Warning>
    **Trava operacional:**
    Esta flag est√° `True` desde a fase de testes e n√£o foi revertida ap√≥s a sa√≠da do desenvolvedor original. Mudar para `False` ativa o envio autom√°tico ‚Äî s√≥ fa√ßa isso ap√≥s valida√ß√£o completa com a equipe de cobran√ßa.
    </Warning>
    
    **Se MODO_PREVIEW = False:**
    - Sistema envia automaticamente
    - Operador n√£o precisa clicar em "Enviar"
    - Mais r√°pido, mas menos controle
  </Step>
</Steps>

## Fase 5: Finaliza√ß√£o (manual)

<Steps>
  <Step title="Mover boletos para pasta da opera√ß√£o">
    Ap√≥s enviar todos os e-mails, **recortar** (n√£o copiar) os boletos de `BoletosEnviados/` para a pasta da opera√ß√£o no servidor:
    
    ```
    Origem:  C:\BoletosAutoma√ß√£o\BoletosEnviados\
    Destino: \\SERVIDOR\Cobran√ßas\Cobran√ßa NOVAX\2025\Opera√ß√£o 1234\Boletos\
    ```
    
    **Finalidade:**
    - Hist√≥rico permanente da opera√ß√£o
    - Auditoria futura
    - Reenvio se cliente solicitar
  </Step>
  
  <Step title="Deletar XMLs da pasta Notas/">
    Limpar a pasta `Notas/` para evitar conflitos na pr√≥xima opera√ß√£o:
    
    ```
    C:\BoletosAutoma√ß√£o\Notas\
    ```
    
    <Warning>
    **Cr√≠tico:** Arquivos residuais (XMLs de opera√ß√µes anteriores) causam erros de valida√ß√£o na pr√≥xima execu√ß√£o. O sistema pode tentar fazer match com XMLs errados.
    </Warning>
  </Step>
  
  <Step title="Zerar pastas operacionais">
    Verificar que as seguintes pastas est√£o vazias:
    
    - `BoletosEntrada/` - Deve estar vazia (todos foram renomeados)
    - `BoletosRenomeados/` - Deve estar vazia (todos foram enviados)
    - `BoletosEnviados/` - Deve estar vazia (todos foram arquivados)
    - `Notas/` - Deve estar vazia (XMLs deletados)
    
    <Tip>
    Se alguma pasta n√£o estiver vazia, investigar:
    - Boletos n√£o processados?
    - Erros de valida√ß√£o?
    - Arquivos esquecidos?
    </Tip>
  </Step>
  
  <Step title="Verificar logs de auditoria">
    O sistema gera automaticamente relat√≥rios de auditoria:
    
    **Pasta Auditoria/:**
    - `auditoria_aprovados_[data].txt` - Boletos enviados com sucesso
    - `auditoria_[data].json` - Dados estruturados (JSON)
    - `erros_criticos_[data].log` - Erros cr√≠ticos (se houver)
    
    **Pasta Erros/:**
    - `erros_[data].txt` - Boletos rejeitados com motivo
    
    **O que conferir:**
    - Taxa de sucesso (deve ser pr√≥xima de 100%)
    - Boletos rejeitados (investigar motivo)
    - Erros cr√≠ticos (resolver antes da pr√≥xima opera√ß√£o)
  </Step>
</Steps>

## Ciclo de vida do arquivo (boleto)

Este diagrama mostra todas as transforma√ß√µes que um boleto sofre durante o processo:

```mermaid
stateDiagram-v2
    [*] --> PDFUnico: FIDC gera boletos
    PDFUnico --> PDFsSeparados: iLovePDF (MANUAL)
    PDFsSeparados --> BoletosEntrada: Operador move (MANUAL)
    BoletosEntrada --> BoletosRenomeados: Sistema renomeia (AUTO)
    BoletosRenomeados --> BoletosEnviados: Sistema envia (SEMI-AUTO)
    BoletosEnviados --> PastaOperacao: Operador arquiva (MANUAL)
    PastaOperacao --> [*]: Hist√≥rico permanente
    
    BoletosEntrada --> Erros: Valida√ß√£o falhou
    BoletosRenomeados --> Erros: Valida√ß√£o falhou
    Erros --> [*]: Investigar e corrigir
    
    note right of PDFUnico
        Formato: 1 PDF com N p√°ginas
        Origem: Portal da FIDC
    end note
    
    note right of PDFsSeparados
        Formato: N PDFs individuais
        Nomes: 1.pdf, 2.pdf, etc.
    end note
    
    note right of BoletosRenomeados
        Formato: NOME - NF 123456 - DD-MM - R$ X.XXX,XX.pdf
        Dados extra√≠dos do PDF + XML
    end note
    
    note right of BoletosEnviados
        Boletos validados e enviados
        Aguardando arquivamento
    end note
    
    note right of PastaOperacao
        \\SERVIDOR\Cobran√ßas\[FIDC]\[Ano]\[Opera√ß√£o]\
        Hist√≥rico permanente
    end note
```

## Pontos cr√≠ticos de aten√ß√£o

### 1. XMLs s√£o obrigat√≥rios

<Warning>
O sistema **n√£o envia** boletos sem XML correspondente. Isso √© uma prote√ß√£o cr√≠tica para evitar:
- Envio para e-mail errado
- Valor incorreto
- Cliente errado
</Warning>

**Solu√ß√£o:** Sempre verificar que todos os XMLs est√£o na pasta `Notas/` antes de processar.

### 2. Arquivos residuais causam erros

<Warning>
XMLs de opera√ß√µes anteriores na pasta `Notas/` causam erros de valida√ß√£o. O sistema pode tentar fazer match com XMLs errados.
</Warning>

**Solu√ß√£o:** Sempre deletar XMLs ap√≥s finalizar a opera√ß√£o.

### 3. MODO_PREVIEW est√° ativo

<Warning>
O sistema est√° em modo preview desde os testes. E-mails n√£o s√£o enviados automaticamente ‚Äî operador precisa clicar em "Enviar" manualmente em cada e-mail.
</Warning>

**Solu√ß√£o:** Ap√≥s valida√ß√£o completa, alterar `MODO_PREVIEW = False` no arquivo `config.py`.

### 4. Valida√ß√£o de totais √© manual

<Warning>
O sistema n√£o valida automaticamente se a quantidade e valor total dos boletos batem com o Termo de Duplicatas. Essa confer√™ncia √© responsabilidade do operador.
</Warning>

**Solu√ß√£o:** Sempre conferir totais antes de enviar.

### 5. iLovePDF √© site p√∫blico

<Warning>
Ao usar iLovePDF para separar boletos, os arquivos ficam temporariamente em servidores externos. Deletar os arquivos do site ap√≥s o download.
</Warning>

**Solu√ß√£o:** Considerar ferramenta local (ex: Adobe Acrobat, PDFtk) para maior seguran√ßa.

## Tempo estimado por opera√ß√£o

| Fase | Tempo estimado | Tipo |
|------|----------------|------|
| **1. Prepara√ß√£o** | 5-10 min | Manual |
| **2. Coleta** | 10-15 min | Manual |
| **3. Processamento** | 2-5 min | Automatizado |
| **4. Envio** | 5-10 min | Semi-automatizado |
| **5. Finaliza√ß√£o** | 5 min | Manual |
| **TOTAL** | **27-45 min** | - |

<Note>
Tempo varia conforme:
- Quantidade de boletos (5-50 boletos t√≠pico)
- Complexidade da opera√ß√£o (m√∫ltiplos clientes)
- Erros de valida√ß√£o (retrabalho)
</Note>

## Checklist operacional

Use este checklist para garantir que todas as etapas foram executadas:

### Antes de processar
- [ ] Opera√ß√£o aprovada pela FIDC
- [ ] Termo de Duplicatas assinado
- [ ] Estrutura de pastas criada no servidor
- [ ] XMLs copiados para pasta `Notas/`
- [ ] Boletos baixados e separados
- [ ] Boletos movidos para `BoletosEntrada/`

### Durante o processamento
- [ ] FIDC correto selecionado na interface
- [ ] Renomea√ß√£o executada sem erros
- [ ] Confer√™ncia visual dos nomes (opcional)
- [ ] Totais conferidos (quantidade + valor)
- [ ] Envio executado
- [ ] E-mails conferidos no Outlook
- [ ] E-mails enviados manualmente (modo preview)

### Ap√≥s o envio
- [ ] Boletos movidos para pasta da opera√ß√£o
- [ ] XMLs deletados da pasta `Notas/`
- [ ] Pastas operacionais zeradas
- [ ] Logs de auditoria verificados
- [ ] Taxa de sucesso pr√≥xima de 100%
- [ ] Erros investigados e resolvidos

## Pr√≥ximos passos

Ap√≥s dominar o fluxo operacional, consulte:

- [Estrutura do Projeto](/automacao-de-boletos/estrutura-do-projeto) - Entenda a arquitetura t√©cnica
- [Contexto de Neg√≥cio](/automacao-de-boletos/contexto-de-negocio) - Compreenda o processo financeiro
